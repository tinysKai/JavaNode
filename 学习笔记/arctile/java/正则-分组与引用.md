## 正则-分组与引用

### 定义

括号在正则中可以用于分组，被括号括起来的部分“子表达式”会被保存成一个子组。

我们可以写出如图所示的正则，将日期和时间都括号括起来。这个正则中一共有两个分组，日期是第 1 个，时间是第 2 个。

![87d896f423780c43199222e32c4e428a.png](http://ww1.sinaimg.cn/large/8bb38904gy1ggbuocx94tj20vm09gq3g.jpg)

### 不保存子组

在实际使用时，如果没必要保存子组的。这时我们可以在括号里面使用 `?: `不保存子组。

![4b14f91e4307580bb482c58232c3f1fb.png](http://ww1.sinaimg.cn/large/8bb38904gy1ggbuqm80xdj21ma0ng0z1.jpg)

### 括号嵌套

在括号嵌套的情况里，我们要看某个括号里面的内容是第几个分组怎么办？不要担心，其实方法很简单，我们只需要数左括号（开括号）是第几个，就可以确定是第几个子组。

![083b6a8af68f56f3120b7c8875329340.png](http://ww1.sinaimg.cn/large/8bb38904gy1ggburnjdz7j20zm094dgj.jpg)

日期分组编号是 1，时间分组编号是 5，年月日对应的分组编号分别是 2，3，4，时分秒的分组编号分别是 6，7，8。

### 分组引用

![c4eef43e2ccf55978b949a194a175594.jpg](http://ww1.sinaimg.cn/large/8bb38904gy1ggbuscfw3yj20lm07nmy5.jpg)

### 分组替换

比如我们要找重复出现的单词，我们使用正则可以很方便地使“前面出现的单词再次出现”，具体要怎么操作呢？我们可以使用 \w+ 来表示一个单词，针对刚刚的问题，我们就可以很容易写出 (\w+) \1 这个正则表达式了。

![3951b939651d32402e9efe63a83e7de6.png](http://ww1.sinaimg.cn/large/8bb38904gy1ggbutn84glj20tw0umabz.jpg)

![b2465f3f8c50432b622ec8704dc8a214.png](http://ww1.sinaimg.cn/large/8bb38904gy1ggbuujtulgj20tw0w6ju8.jpg)

```python
>>> import re
>>> test_str = "2020-05-10 20:23:05"
>>> regex = r"((\d{4})-(\d{2})-(\d{2})) ((\d{2}):(\d{2}):(\d{2}))"
>>> subst = r"日期\1 时间\5   \2年\3月\4日 \6时\7分\8秒"
>>> re.sub(regex, subst, test_str)
# 输出 '日期2020-05-10 时间20:23:05   2020年05月10日 20时23分05秒'
```

### 思考题

the little cat cat is in the hat hat hat, we like it.

其中 cat 和 hat 连接出现多次，要求处理后结果是the little cat is in the hat, we like it.

>  思考题答案是： 
>
> 正则：(\w+)(\s+\1)+
>
> 替换：\1
>
> 解题的思路是：\w+  用于选中出现一次到多次的字母，由于默认贪婪匹配最长，所以能选中每个单词，由于是要找出重复的单词，所以要用第一次匹配成功的结果即使用分组  (\w+) \1，到此可以拿到重复两次场景的结果，对于重复两次以上的结果，需要重复刚刚的行为，但是不能一直叠加 \1 ，自然想到了 +,得到了  (\w+)  (\1)+，发现匹配不成功，在这里卡壳了一段时间没想明白，翻到别人的答案才猛然想起来单词之间应该有空隙，(\1)+不能表示空隙，用\s代替敲出来的空格最终得到  (\w+)(\s+\1)+  晚上比较晚了脑子转不动了  